function Level(){this.platforms=null,this.geometry=null,this.enemies=null,this.createSky(),this.createRain(),this.createPlatforms(),this.createEnemies()}function checkForCameraShake(){if(shakeWorldTime>0){var e=shakeWorldTime/shakeWorldTimeMax*shakeWorldMax,t=game.rnd.integerInRange(-e,e),i=game.rnd.integerInRange(-e,e);game.world.setBounds(t,i,game.width+t,game.height+i),shakeWorldTime--,0===shakeWorldTime&&game.world.setBounds(0,0,game.width,game.height)}}function cameraShake(e){shakeWorldTime=e}function Actor(e,t){Phaser.Sprite.call(this,game,e.x,e.y,t),this.moveSpeed=15,this.jumpTimer=0,this.jumpDuration=.3,this.jumpSpeed=30,this.doubleJumped=!1,this.airborne=!1,this.bounce=.2,this.gravity=1600,game.physics.arcade.enable(this),this.body.drag.x=100,this.body.bounce.y=.2,this.body.gravity.y=this.gravity,this.body.collideWorldBounds=!0,game.add.existing(this),this.bloodEmitter=game.add.emitter(0,0,100),this.bloodEmitter.setScale(1,5,1,5),this.bloodEmitter.gravity=this.gravity,this.bloodEmitter.makeParticles("blood",[0,1,2,3,4,5,6,7],500,!0)}function Player(e){Actor.call(this,e,"dude"),this.fallThrough=!1,this.bullets=game.add.group(),this.fireRate=100,this.nextFire=0,this.score=0,this.multiplier=0,this.gameOverText=game.add.text(game.world.centerX,150,"GAME OVER",{font:"96px Arial",fill:"#ffffff",align:"center"}),this.gameOverText.anchor.setTo(.5,.5),this.gameOverText.setShadow(0,5,"rgba(128,128,128,1)"),this.clickText=game.add.text(game.world.centerX,300,"- click to restart -",{font:"40px Arial",fill:"#ffffff",align:"center"}),this.clickText.anchor.setTo(.5,.5),this.gameOverText.visible=!1,this.clickText.visible=!1,this.events.onKilled.add(this.die,this),this.body.checkCollision.up=!1,this.body.setSize(20,32,10,16),this.flashEmitter=game.add.emitter(0,0,1),this.flashEmitter.setScale(1,2,1,2),this.flashEmitter.gravity=0,this.flashEmitter.setXSpeed(0,0),this.flashEmitter.setYSpeed(0,0),this.flashEmitter.makeParticles("flash"),this.bullets.enableBody=!0,this.bullets.physicsBodyType=Phaser.Physics.ARCADE,this.bullets.createMultiple(50,"bullet"),this.bullets.setAll("checkWorldBounds",!0),this.bullets.setAll("outOfBoundsKill",!0),this.bullets.setAll("anchor.x",.5),this.bullets.setAll("body.mass",.1),this.bullets.setAll("anchor.y",.5),this.bullets.callAll("body.setSize","body",4,2,0,-3),this.bullets.callAll("animations.add","animations","fire",[0,1,2,3],60),game.camera.follow(this.sprite,Phaser.Camera.FOLLOW_PLATFORMER),this.animations.add("left",[0,1,2,3],10,!0),this.animations.add("right",[5,6,7,8],10,!0),this.controls={up:game.input.keyboard.addKey(Phaser.Keyboard.W),left:game.input.keyboard.addKey(Phaser.Keyboard.A),down:game.input.keyboard.addKey(Phaser.Keyboard.S),right:game.input.keyboard.addKey(Phaser.Keyboard.D)},this.controls.up.onUp.add(function(){this.airborne&&(this.doubleJumped=!0),this.airborne=!0,this.jumpTimer=0},this)}function Soldier(e){Actor.call(this,e,"soldier"),this.body.mass=100,this.anchor.x=.5,this.anchor.y=.5,this.animations.add("left",[0,1,2,3],10,!0),this.animations.add("right",[5,6,7,8],10,!0),this.moving=1===game.rnd.between(0,1)?"right":"left"}var Ludum={};Ludum.Boot=function(){},Ludum.Boot.prototype.preload=function(){this.load.image("ground","assets/platform.png")},Ludum.Boot.prototype.create=function(){this.game.state.start("Preloader")},Level.prototype.update=function(){if(this.enemies.countDead()>0){var e=this.enemies.getFirstDead();1===game.rnd.between(0,1)?(e.reset(0,game.rnd.between(-20,game.world.height-64-48)),e.moving="right"):(e.reset(game.world.width,game.rnd.between(-20,game.world.height-64-48)),e.moving="left")}},Level.prototype.createEnemies=function(){this.enemies=game.add.group();for(var e=0;1>e;e++)this.enemies.add(new Soldier({x:game.rnd.between(0,1300),y:200}))},Level.prototype.createSky=function(){var e=game.add.sprite(0,0,"sky"),t=game.world.height/e.height,i=game.world.width/e.width;e.scale.setTo(i,t)},Level.prototype.createRain=function(){var e=game.add.emitter(game.world.centerX+50,-200,400);e.width=game.world.width,e.angle=10,e.makeParticles("rain"),e.minParticleScale=.1,e.maxParticleScale=.3,e.setYSpeed(500,800),e.setXSpeed(-5,5),e.minRotation=0,e.maxRotation=0,e.start(!1,1600,5,0)},Level.prototype.createPlatforms=function(){this.platforms=game.add.group(),this.platforms.enableBody=!0,this.geometry=game.add.group(),this.geometry.enableBody=!0;var e=this.geometry.create(-40,game.world.height-64,"ground"),t=(game.world.width+40)/e.width;e.scale.setTo(t,2),e.body.immovable=!0;var i=this.platforms.create(game.world.width-100,game.world.height-200,"ground");i.body.immovable=!0,i.scale.setTo(1,.5),i=this.platforms.create(game.world.width-200,game.world.height-400,"ground"),i.body.immovable=!0,i.scale.setTo(1,.5),i=this.platforms.create(-300,game.world.height-200,"ground"),i.body.immovable=!0,i.scale.setTo(1,.5),i=this.platforms.create(-200,game.world.height-400,"ground"),i.body.immovable=!0,i.scale.setTo(1,.5)};var game=new Phaser.Game(1334,750,Phaser.AUTO,"game");window.onload=function(){game.state.add("Boot",Ludum.Boot),game.state.add("Preloader",Ludum.Preloader),game.state.add("MainMenu",Ludum.MainMenu),game.state.add("Game",Ludum.Game),game.state.start("Boot")};var shakeWorld=0,shakeWorldMax=20,shakeWorldTime=0,shakeWorldTimeMax=40;Actor.prototype=Object.create(Phaser.Sprite.prototype),Actor.prototype.constructor=Actor,Actor.prototype.moveLeft=function(){this.body.velocity.x=-this.moveSpeed*game.time.physicsElapsedMS,this.animations.play("left")},Actor.prototype.moveRight=function(){this.body.velocity.x=this.moveSpeed*game.time.physicsElapsedMS,this.animations.play("right")},Actor.prototype.jump=function(){this.jumpTimer<this.jumpDuration&&(this.body.velocity.y=-this.jumpSpeed*game.time.physicsElapsedMS,this.jumpTimer+=game.time.physicsElapsed)},Player.prototype=Object.create(Actor.prototype),Player.prototype.constructor=Player,Player.prototype.update=function(){this.body.velocity.x=0,this.controls.left.isDown?this.moveLeft():this.controls.right.isDown?this.moveRight():(this.animations.stop(),this.frame=4),this.controls.up.isDown&&(this.airborne&&this.doubleJumped||this.jump()),this.body.touching.down&&(this.airborne=!1,this.doubleJumped=!1,this.controls.down.isDown&&this.fallThroughFloor()),game.input.activePointer.isDown&&this.fire(),!this.multiplierRecentlyIncreased&&this.alive&&(this.multiplier++,this.multiplierRecentlyIncreased=!0,mxText.text="Multiplier: "+this.multiplier+"x",game.time.events.add(5*Phaser.Timer.SECOND,function(){this.multiplierRecentlyIncreased=!1;var e=new Soldier({x:-20,y:-20});e.kill(),level.enemies.add(e)},this))},Player.prototype.fallThroughFloor=function(){this.fallThrough=!0,game.time.events.add(Phaser.Timer.QUARTER,function(){this.fallThrough=!1},this)},Player.prototype.fire=function(){if(this.alive&&game.time.now>this.nextFire&&this.bullets.countDead()>0){this.nextFire=game.time.now+this.fireRate;var e=this.bullets.getFirstDead();this.body.velocity.x>0?e.reset(this.x+28,this.y+24):0===this.body.velocity.x?e.reset(this.x+16,this.y+24):e.reset(this.x,this.y+24),this.flashEmitter.x=e.x,this.flashEmitter.y=e.y,this.flashEmitter.start(!0,20,null,1),game.physics.arcade.moveToPointer(e,800),e.rotation=game.physics.arcade.angleToPointer(e),e.animations.play("fire")}},Player.prototype.hitEnemy=function(e,t){e.body.velocity.x=game.rnd.between(t.body.velocity.x<0?-100:100,t.body.velocity.x<0?-600:600),e.body.velocity.y=game.rnd.between(0,-800),e.body.angularVelocity=game.rnd.between(-200,200),e.dying||(e.dying=!0,this.score=this.score+100*this.multiplier,scoreText.text="Score: "+this.score,game.time.events.add(Phaser.Timer.SECOND,function(){e.dying=!1,e.angle=0,e.hasBacon&&e.resetBacon(),e.kill()},this),t.kill()),this.bloodEmitter.x=t.x,this.bloodEmitter.y=t.y,this.bloodEmitter.setXSpeed(t.body.velocity.x<0?-50:50,t.body.velocity.x>0?-200:200),this.bloodEmitter.setYSpeed(100,-300),this.bloodEmitter.start(!0,2e3,null,20)},Player.prototype.takeDamage=function(e,t){t.dying||this.recentlyDamaged||(this.body.velocity.x=game.rnd.between(-200,200),this.body.velocity.y=game.rnd.between(-200,-400),cameraShake(20),this.damage(.25),this.recentlyDamaged=!0,this.multiplier=1,mxText.text="Multiplier: "+this.multiplier+"x",game.time.events.add(Phaser.Timer.SECOND,function(){this.recentlyDamaged=!1},this))},Player.prototype.platformCollision=function(){return!this.fallThrough},Player.prototype.die=function(){this.gameOverText.visible=!0,this.clickText.visible=!0,game.input.onDown.add(function(){game.state.start("Game")},this)},Soldier.prototype=Object.create(Actor.prototype),Soldier.prototype.constructor=Soldier,Soldier.prototype.update=function(){if(this.alive&&!this.dying){"left"===this.moving?this.moveLeft():"right"===this.moving&&this.moveRight(),this.body.blocked.left?(this.moving="right",this.hasBacon&&(player.multiplier=1,mxText.text="Multiplier: "+player.multiplier+"x",this.resetBacon())):this.body.blocked.right&&(this.moving="left",this.hasBacon&&(player.multiplier=1,mxText.text="Multiplier: "+player.multiplier+"x",this.resetBacon())),this.body.blocked.down&&this.jump();var e=game.rnd.between(0,100);5===e?this.moving="right":32===e?this.moving="left":73===e&&this.jump()}},Soldier.prototype.resetBacon=function(){bacon.reset(game.world.centerX,game.world.height-64-40),this.hasBacon=!1,this.tint=16777215},Ludum.Game=function(){player=null,level=null,this.debugtext=null,bacon=null},Ludum.Game.prototype.create=function(){game.time.slowMotion=1,game.physics.startSystem(Phaser.Physics.ARCADE),level=new Level,player=new Player({x:240,y:450}),bacon=game.add.sprite(game.world.centerX,game.world.height-64-40,"bacon"),scoreText=game.add.text(20,20,"Score: 0",{font:"20px Arial",fill:"#ffffff",align:"left"}),scoreText.setShadow(0,2,"rgba(128,128,128,1)"),mxText=game.add.text(20,40,"Multiplier: 1",{font:"20px Arial",fill:"#ffffff",align:"left"}),mxText.setShadow(0,2,"rgba(128,128,128,1)"),game.physics.arcade.enable(bacon),bacon.body.immovable=!0},Ludum.Game.prototype.update=function(){game.physics.arcade.collide(player,level.geometry),game.physics.arcade.collide(level.enemies,level.geometry),game.physics.arcade.collide(player.bloodEmitter,level.geometry,function(e){e.body.velocity.x=0}),game.physics.arcade.collide(player,level.platforms,null,player.platformCollision,player),game.physics.arcade.collide(level.enemies,level.platforms),game.physics.arcade.collide(player,bacon),game.physics.arcade.overlap(level.enemies,bacon,function(e,t){t.dying||(e.kill(),t.hasBacon=!0,t.tint=16711680)}),game.physics.arcade.overlap(level.enemies,player.bullets,player.hitEnemy,null,player),game.physics.arcade.overlap(level.enemies,player,player.takeDamage,null,player),level.update(),checkForCameraShake()},Ludum.MainMenu=function(){menuMusic=null},Ludum.MainMenu.prototype.create=function(){game.time.slowMotion=2,this.createRain(),this.makeRainStuff(),menuMusic=game.add.audio("menuMusic",1,!0),menuMusic.play(),baconking=game.add.sprite(game.world.centerX,350,"baconking"),baconking.anchor.setTo(.5,.5);var e=game.add.text(game.world.centerX,150,"BACON DEFENDER",{font:"96px Arial",fill:"#ffffff",align:"center"});e.anchor.setTo(.5,.5),e.setShadow(0,5,"rgba(128,128,128,1)");var t=game.add.text(game.world.centerX,500,"- click to start -",{font:"40px Arial",fill:"#ffffff",align:"center"});t.anchor.setTo(.5,.5);var i=this.add.tween(t);i.to({x:game.world.centerX,y:520,tint:16776960},1e3,Phaser.Easing.Sinusoidal.InOut,!0,100,-1,!0),game.input.onDown.add(this.startGame,this)},Ludum.MainMenu.prototype.startGame=function(){game.state.start("Game")},Ludum.MainMenu.prototype.makeRainStuff=function(){var e=game.add.emitter(game.world.centerX+50,-300,400);e.width=game.world.width,e.angle=10,e.makeParticles(["bacon","soldier"]),e.minParticleScale=.2,e.maxParticleScale=2,e.setYSpeed(1,5),e.setXSpeed(-5,5),e.minRotation=0,e.maxRotation=20,e.start(!1,16e3,300,0)},Ludum.MainMenu.prototype.createRain=function(){var e=game.add.emitter(game.world.centerX+50,-200,400);e.width=game.world.width,e.angle=10,e.makeParticles("rain"),e.minParticleScale=.1,e.maxParticleScale=.3,e.setYSpeed(500,800),e.setXSpeed(-5,5),e.minRotation=0,e.maxRotation=0,e.start(!1,1600,5,0)},Ludum.Preloader=function(){},Ludum.Preloader.prototype.preload=function(){this.stage.backgroundColor="#0d0e0f";var e=game.add.sprite(81,215,"ground");this.load.setPreloadSprite(e),game.add.text(game.world.centerX,400,"LOADING",{font:"60px Arial",fill:"#ffffff",align:"center"}).anchor.setTo(.5,.5),this.load.image("sky","assets/night_sky.png"),this.load.image("bacon","assets/bacon.png"),this.load.image("baconking","assets/baconking.png"),this.load.spritesheet("soldier","assets/ninja.png",24,48),this.load.spritesheet("dude","assets/dude.png",24,48),this.load.spritesheet("bullet","assets/bullet.png",16,8),this.load.spritesheet("blood","assets/blood.png",1,1),this.load.spritesheet("flash","assets/flash.png",38,38),this.load.spritesheet("rain","assets/rain.png",17,17),this.load.spritesheet("startButton","assets/startbutton.png",100,50),game.load.audio("menuMusic","assets/menu.mp3")},Ludum.Preloader.prototype.create=function(){this.game.state.start("MainMenu")};